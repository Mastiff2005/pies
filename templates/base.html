<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>{% block title %}{% endblock %} | CAKEPOINT</title>
    <!-- Загрузка статики -->
    {% load static %}
  	<link rel="icon" href="{% static 'favicon.ico' %}" type="image/x-icon" />
    <link rel="stylesheet" href="{% static 'bootstrap/dist/css/bootstrap.min.css' %}">
    <script src="{% static 'jquery/dist/jquery.min.js' %}"></script>
    <script src="{% static 'popper.js/dist/popper.min.js' %}"></script>
    <script src="{% static 'bootstrap/dist/js/bootstrap.min.js' %}"></script>
    <script>
        let cookie = document.cookie
		let csrfToken = cookie.substring(cookie.indexOf('=') + 1)

		function add_product(productID, quantity, update) {
			// Добавляем продукт в корзину
			let count = document.getElementById(productID);
	    	let clicks = parseInt(count.innerHTML);
	    	clicks += 1;
			$.ajax({
		        url: "/cart/add/" + productID + '/',
		        method: 'POST',
		        headers: {'X-CSRFToken': csrfToken},
		        data: {"quantity": quantity, "update": update},
		        success: function(data) {
        			console.log(data);
    			}
		    });
		    count.innerHTML = clicks;
			// Выводим сумму товаров в корзине и меняем отображение корзины
			let cartSum = document.getElementById("cartSum");
			let cartImg = document.getElementById("cartImg");
			setTimeout(() => {
				$.ajax({
					url: "/api/cart_view/",
					method: 'GET',
					success: function(data) {
						cartSum.innerHTML = data["total_price"] + " руб.";
						cartImg.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-cart-fill" viewBox="0 0 16 16"><path d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .491.592l-1.5 8A.5.5 0 0 1 13 12H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/></svg>';
					}
				});
			}, 250);
		}
		
		function remove_product(productID, quantity, update) {
			// Убираем продукт из корзины
			let count = document.getElementById(productID);
	    	let clicks = parseInt(count.innerHTML);
	    	clicks = 0;
			$.ajax({
		        url: "/cart/remove/" + productID + '/',
		        method: 'POST',
		        headers: {'X-CSRFToken': csrfToken},
		        data: {"quantity": quantity, "update": update},
		        success: function(data) {
        			console.log(data);
    			}
		    });
		    count.innerHTML = clicks;
			// Выводим сумму товаров в корзине
			let cartSum = document.getElementById("cartSum");
			let cartImg = document.getElementById("cartImg");
			setTimeout(() => {
				$.ajax({
					url: "/api/cart_view/",
					method: 'GET',
					success: function(data) {
						cartSum.innerHTML = data["total_price"] + " руб.";
						if (data["total_price"] == 0) {
							cartImg.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-cart" viewBox="0 0 16 16"><path d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .491.592l-1.5 8A.5.5 0 0 1 13 12H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5zM3.102 4l1.313 7h8.17l1.313-7H3.102zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/></svg>';
						}
					}
				});
			}, 250);
		}
		
		function closeCart() {
			document.getElementById("cart_popup").style.display = "none";
		}
		
		function openCart() {
			document.getElementById("cart_popup").style.display = "block";
			let cartView = document.getElementById("cart_popup");
			cartView.innerHTML = "<b><big>Ваша корзина</big></b><br><br>"
			$.ajax({
				url: "/api/cart_view/",
				method: 'GET',
				success: function(data) {
					let arr = data["items"];
					let len= arr.length;
					for (let number = 0; number < len; number++) {
						cartView.innerHTML += data["items"][number]["name"] + " -- ";
					    cartView.innerHTML += data["items"][number]["quantity"] + "шт. -- ";
					    cartView.innerHTML += data["items"][number]["price"] + " руб.<br>";
					}
					cartView.innerHTML += "<br>";
					cartView.innerHTML += "<b>" + data["quantity"] + " позиций,</b>";
					cartView.innerHTML += "<b> на сумму " + data["total_price"] + " руб.</b><br><br>";
					cartView.innerHTML += "<a href='{% url 'cart:cart_detail' %}'><button class='button_2' style='width: 170px'>Перейти в корзину</button></a>&nbsp;";
					cartView.innerHTML += "<button class='button_1' onclick='closeCart()'>Закрыть</button>";
				}
			});
		}
		
	</script>

	<style>
		.body {
    		background-color: #FFE4C4;
		}
		b, h3, h5 {
			color: #800000;
		}
		.content {
			margin-top: 0;
			margin-bottom: 10px;
		}
		.responsive {
			max-width: 100%;
			height: auto;
		}
		.card_1 {
			width: 250px;
			background-color: #fcdeb8;
			margin-bottom: 5px;
			padding: 5px 5px 5px 5px;
			display: inline-block;
			text-align: center;
			box-shadow: 2px 2px 2px rgba(0, 0, 0, .4);
			border: 1px solid #800000;
		}
		.cart {
			width: 95px;
			height: 50px;
			padding-top: 5px;
			padding-bottom: 60px;
			color: dodgerblue;
			text-align: center;
			font-weight: 700;
			border-radius: 4px;
			box-shadow: 2px 2px 2px rgba(0, 0, 0, .4);
			border: 1px solid #800000;
			background: rgba(255,228,196, 0.7);
			position: fixed;
			right: 2%;
			bottom: 2%;
		}
		.cart-popup {
			display: none;
			width: 330px;
			padding: 10px;
			right: 2%;
			bottom: 15%;
			position: fixed;
			border-radius: 4px;
			box-shadow: 2px 2px 2px rgba(0, 0, 0, .4);
			border: 1px solid #800000;
			color: dodgerblue;
			text-align: left;
			background: rgba(255,228,196, 0.93);
    	}
		.button_1 {
			width: 100px;
			background-color: #ebc0a2;
			color: #800000;
			font-weight: 700;
			border-radius: 4px;
			border-color: #ebc0a2;
		}
		.button_2 {
			width: 100px;
			background-color: #e8c15f;
			color: #800000;
			font-weight: 700;
			border-radius: 4px;
			border-color: #e8c15f;
		}
		.productImg {
			border-radius: 5px;
			cursor: pointer;
			transition: 0.3s;
		}
		.modal {
			display: none;
			position: fixed;
			z-index: 1;
			padding-top: 100px;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			overflow: auto;
			background-color: rgb(0, 0, 0);
			background-color: rgba(0, 0, 0, .9);
		}
		.modal-content {
			margin: auto;
			display: block;
			width: 80%;
			max-width: 600px;
		}
		#caption {
			margin: auto;
			display: block;
			width: 80%;
			max-width: 700px;
			text-align: center;
			color: #ccc;
			padding: 10px 0;
			height: 150px;
		}
		.modal-content, .cart-popup, #caption {
			-webkit-animation-name: zoom;
			-webkit-animation-duration: 0.4s;
			animation-name: zoom;
			animation-duration: 0.4s;
		}
		@-webkit-keyframes zoom {
			from {-webkit-transform: scale(0);}
			to {-webkit-transform: scale(1);}
		}
		@keyframes zoom {
			from {transform: scale(0);}
			to {transform: scale(1);}
		}
		.close {
			position: absolute;
			top: 45px;
			right: 2%;
			color: #f1f1f1;
			font-size: 50px;
			font-weight: bold;
			transition: 0.3s;
		}
		.close:hover, .close:focus {
			color: #bbb;
			text-decoration: none;
			cursor: pointer;
		}
		@media only screen and (max-width: 700px) {
			.modal-content {width: 100%;}
		}
	</style>

</head>
<body class="body">
    {% include 'nav.html' %}
    <main class="content">
        <div class="container">
            <h1>{% block header %}{% endblock %}</h1>
            {% block content %}
            <!-- Содержимое страницы -->
            {% endblock %}
        </div>
    </main>
</body>

</html>